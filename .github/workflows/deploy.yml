name: Deploy Astro Site to FTP

on:
  push:
    branches:
      - main  # ç›£è½ main åˆ†æ”¯ï¼Œä¸€æœ‰ push å°±åŸ·è¡Œ

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    steps:
      # 1. ä¸‹è¼‰ä½ çš„ç¨‹å¼ç¢¼
      - name: ğŸšš Get latest code
        uses: actions/checkout@v4

      # 2. å®‰è£ Node.js ç’°å¢ƒ
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # ä½¿ç”¨è¼ƒæ–°çš„ Node ç‰ˆæœ¬

      # 3. å®‰è£å¥—ä»¶ä¸¦æ‰“åŒ… (Build)
      - name: ğŸ”¨ Install & Build
        run: |
          npm install
          npm run build

      # 4. é€é FTP ä¸Šå‚³ dist è³‡æ–™å¤¾çš„å…§å®¹
      - name: ğŸ“‚ Sync files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          # Astro æ‰“åŒ…å¾Œçš„æˆå“æœƒæ”¾åœ¨ dist è³‡æ–™å¤¾
          local-dir: ./dist/
          # ä¸Šå‚³åˆ° FTP çš„æ ¹ç›®éŒ„ (é€šå¸¸ publish@tohot.xyz å·²ç¶“å°æ‡‰åˆ°ç¶²ç«™è³‡æ–™å¤¾äº†)
          server-dir: ./
          # å®‰å…¨è¨­å®š (è‹¥é‡åˆ°æ†‘è­‰å•é¡Œå¯èª¿æ•´ï¼Œç›®å‰å…ˆè¨­ç‚º false ç¢ºä¿ç›¸å®¹æ€§)
          strict: false